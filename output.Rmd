---
title: "Output"
output: pdf_document
---

```{r, echo=FALSE, message=FALSE}
library(ggplot2)
library(tidyr)
library(dplyr)

dt <- read.csv("../raw data/alldata_Part1.csv")


### By area by crime type ###

visual.fun <- function(year=NULL, state = 'WISCONSIN',  type='reported', data=dt){
  
  #mydata <- paste(paste("Data", year, sep=""), "Part1", sep = "_")
  indicator <- ifelse(type=='reported', 'Y', 'N')
  
  if(!is.null(year)){
    mydata <- data[which(data$Year == year),]
    
    fig <- 
      mydata  %>%
      filter(State == state) %>%
      gather(., crimetype, number_of_crime, ViolentCrime:Motorvehicletheft, factor_key = TRUE) %>%
      filter(Actual == indicator)%>%
      filter(!is.na(as.numeric(number_of_crime)))
    
    fig$number_of_crime <- as.numeric(fig$number_of_crime)
    
    min.dt <- min(fig$number_of_crime, na.rm = T)
    max.dt <- max(fig$number_of_crime, na.rm = T)
    
    p1 <- ggplot(aes(x=crimetype, y=number_of_crime,fill=Area), data=fig) +
      geom_bar(stat="identity", width=.5, position = "dodge") +
      facet_wrap(~Area)+
      scale_y_continuous(breaks = seq(min.dt, max.dt, length.out = 5)) + 
      xlab("Crime Type") +
      ylab("Number of Cases") + 
      ggtitle(paste("Barplot of Crime Type by Area for State", state, sep=" ")) +
      theme_bw() +
      theme(axis.text.x = element_text(size = 12, angle = 60, hjust = 1),
            legend.position = 'none') 
    
    
    ### by crime type ###
    
    fig1 <- 
      mydata  %>%
      filter(State == state) %>%
      gather(., crimetype, number_of_crime, ViolentCrime:Motorvehicletheft, factor_key = TRUE) %>%
      filter(Actual == indicator) %>%
      group_by(State, crimetype) %>%
      summarise(total = sum(as.numeric(number_of_crime))) %>%
      filter(!is.na(total))
    
    
    min.dt <- min(fig1$total, na.rm = T)
    max.dt <- max(fig1$total, na.rm = T)
    
    
    p2 <- ggplot(aes(x=crimetype, y=total), data=fig1) +
      geom_bar(stat="identity", width=.5, position = "dodge") +
      scale_y_continuous(breaks = seq(min.dt, max.dt, length.out = 5)) + 
      xlab("Crime Type") +
      ylab("Number of Cases") + 
      ggtitle(paste("Barplot of Crime Type for State", state, sep=" ")) +
      theme_bw() +
      theme(axis.text.x = element_text(size = 12, angle = 60, hjust = 1),
            legend.position = 'none') 
    
    
    ### Spine plot ###
    
    p3 <- ggplot(aes(x=crimetype, y=number_of_crime, fill=Area), data=fig) +
      geom_bar(stat="identity", position="fill") +
      xlab("Crime Type") +
      ylab("Number of Cases") + 
      ggtitle(paste("Spineplot of Crime Type for State", state, sep=" ")) +
      theme_bw() +
      theme(axis.text.x = element_text(size = 12, angle = 60, hjust = 1)) 
    
    return.list <- list("Barplot.by.area" = p1, 
                        "Barplot.by.type" = p2,
                        "spineplot" = p3)
  }
  
  if(is.null(year)){
    ## property crime & violent crime ## 

    
    fig1 <- 
      dt  %>%
      filter(State == state) %>%
      gather(., crimetype, number_of_crime, ViolentCrime:Motorvehicletheft, factor_key = TRUE) %>%
      filter(Actual == indicator) %>%
      group_by(Year, State, crimetype) %>%
      summarise(total = sum(as.numeric(number_of_crime))) %>%
      filter(!is.na(total)) %>%
      filter(crimetype %in% c("PropertyCrime", "ViolentCrime")) %>%
      arrange(Year, crimetype)
    
    fig1$Year <- as.character(fig1$Year)
    
    min.dt <- min(fig1$total)
    max.dt <- max(fig1$total)
    
    p4 <- ggplot(aes(x=Year, y=total, group=crimetype, col=crimetype), data=fig1) +
      geom_line()+
      scale_y_continuous(breaks = seq(min.dt, max.dt, length.out = 10)) + 
      #scale_x_discrete()
      xlab("Year") +
      ylab("Number of Cases") + 
      ggtitle(paste("Lineplot of Number of Crimes by Year", state, sep="~")) +
      theme_bw() +
      theme(axis.text.x = element_text(size = 12, angle = 60, hjust = 1),
            legend.position = 'right') 
    
    return.list <- list("lineplot" = p4)
  }
  
  
  return(return.list)
  
}
```

# Barplot and Spineplot in 2019 for 3 States in New England Area

The year 2019 is used as our example for illustration purpose. All the relevant plots of other years can be obtained easily by changing the function parameters. In 2019, we can observe that most crimes in these 3 states occurred in metropolitan area, which makes sense as this area is the most populated region, so the crime cases were supposed to be higher. Interestingly, the cases of "robbery" and "murder and non negligent manslaughter" mainly occurred in outside of metropolitan and rural areas. This result may lead to potential policy changes on the arrangement of armed police officers and weapon distribution.


```{r, warning=FALSE, message=FALSE}
fig_CT <- visual.fun(year = 2019, state = "CONNECTICUT")  
fig_MA <- visual.fun(year = 2019, state = "MASSACHUSETTS") 
fig_NY <- visual.fun(year = 2019, state = "NEW YORK")  

fig_CT$Barplot.by.area
fig_MA$Barplot.by.area
fig_NY$Barplot.by.area

fig_CT$spineplot
fig_MA$spineplot
fig_NY$spineplot


```